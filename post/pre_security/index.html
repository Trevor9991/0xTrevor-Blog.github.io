<!DOCTYPE html>
<html lang="en-us">
<title>Pre_Security | 0xTrevor Blog</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.85.0" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://0xTrevor-Blog.githup.io/css/index.css">
<link rel="canonical" href="https://0xTrevor-Blog.githup.io/post/pre_security/">
<link rel="alternate" type="application/rss+xml" href="" title="0xTrevor Blog">

<header>
  
    <a href="https://0xTrevor-Blog.githup.io/" class="title">0xTrevor Blog</a>
  
  
</header>

<article>
  <header>
    <h1>Pre_Security</h1>
    <time datetime="2021-07-07T21:26:07&#43;02:00">July 07, 2021</time>
  </header>
  <p>Write-up For TryHackMe Pre-Security path</p>

</article>

<p dir="ltr" style="text-align: left;"></p><p dir="ltr" style="text-align: justify;"><img class="mfp-img" src="http://assets.tryhackme.com/additional/investigation-series/investigations.png" style="max-height: 536px;" /></p><p dir="ltr" style="text-align: justify;">&nbsp;</p><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details" style="margin-right: 40px; text-align: center;"><h4>&nbsp; <span style="font-size: large;">Key letters (Q for Question - A for Answer - E for Explain) <br /></span></h4></div><div class="room-task-question-details" style="margin-right: 40px; text-align: left;"><span style="font-size: large;">Q1: What registry key contains the same command that is executed within a scheduled task<br /></span></div><div class="room-task-question-details" style="margin-right: 40px; text-align: left;"><span style="font-size: large;">&nbsp;A1: HKCU\Environment\UserIntMprLogonScript</span></div><div class="room-task-question-details" style="margin-right: 40px; text-align: left;"><span style="font-size: large;">E1: Open task s</span><span style="font-size: large;">cheduler</span></div><div class="room-task-question-details" style="margin-right: 40px; text-align: left;"><span style="font-size: large;">&nbsp;</span> </div><p dir="ltr" style="text-align: justify;"><span style="background-color: white;"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--wgbiAEgD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/j86da9nr9r88pewvzq3r.PNG" /></span></p></div><p dir="ltr" style="text-align: left;"><span style="font-size: large;">&nbsp;From Regedit, you will see that command for</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">(</span><span style="font-size: large;"><span style="font-family: times;"><code><span style="font-family: times;">sekurlsa</span></code> or <code></code></span>logonpasswords)</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q2: What analysis tool will immediately close if/when you attempt to launch it?</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">A2: procexp64.exe</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E2: </span><span style="font-size: large;">In Sy<span id="rmm"><span id="rmm"><span id="rmm"><span id="rmm"><span id="rmm"><span id="rmm">s</span></span></span></span></span></span>internalSuite folder, if you try to open procexp64.exe<code></code><code class="ol pa pb pc pd b"></code> it will close immediately</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">Q3: What is the full WQL Query associated with this script? <br /></span></p><div dir="ltr" style="text-align: left;"><p><span style="font-size: large;">A3:&nbsp;SELECT * FROM Win32_ProcessStartTrace WHERE ProcessName = 'procexp64.exe'</span></p><p><span style="font-size: large;">&nbsp;E3: Use loki.exe</span></p><p></p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-6fjNOsCRw8M/YOiaZ_ICmOI/AAAAAAAAAHI/e5EGF4ZGusIr5g9uc2cU3A_j1UFh8SZ-ACNcBGAsYHQ/s1000/1%2BSNB027bSDUVjLqLuQbCKxw.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="195" data-original-width="1000" height="189" src="https://1.bp.blogspot.com/-6fjNOsCRw8M/YOiaZ_ICmOI/AAAAAAAAAHI/e5EGF4ZGusIr5g9uc2cU3A_j1UFh8SZ-ACNcBGAsYHQ/w643-h189/1%2BSNB027bSDUVjLqLuQbCKxw.png" width="643" /></a></div><br /><span style="font-size: large;">Q4: </span><span style="font-size: large;">What is the script language?</span><p></p><p><span style="font-size: large;">A4: VBScript</span></p><div style="text-align: left;"><span style="font-size: large;">E4:&nbsp; You can find it in </span><span style="font-size: large;">the file</span><span style="font-family: times;"><span style="font-size: large;"><code> <span style="font-family: times;">(\TMP\WMIBackdoor.psl)</span></code></span></span><span style="font-family: times;"><span style="font-size: large;"><code> </code></span></span><span style="font-family: times;"><span style="font-size: large;"><code></code></span></span></div></div><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">Q5: What is the name of the other script?</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">A5: LaunchBeaconingBackdoor</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">E5: From loki output</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;"><span>Q6: </span>What is the name of the software company visible within the script?</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">A6: Motobit Software</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">E6: From the above script (\TMP\WMIBackdoor.psl)</span></p><p dir="ltr" style="text-align: justify;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-jE3I2bYozu0/YOihbDztH9I/AAAAAAAAAHQ/OgwRpqs7GHMo4sOaus9cJ33uKe4dmWlLgCNcBGAsYHQ/s520/1%2BAkDX7gFkDQ3WcoSKteiZsQ.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="339" data-original-width="520" height="270" src="https://1.bp.blogspot.com/-jE3I2bYozu0/YOihbDztH9I/AAAAAAAAAHQ/OgwRpqs7GHMo4sOaus9cJ33uKe4dmWlLgCNcBGAsYHQ/w636-h270/1%2BAkDX7gFkDQ3WcoSKteiZsQ.png" width="636" /></a></div><br /><span style="font-size: large;">Q7:</span> <span style="font-size: large;">What 2 websites are associated with this software company? (<b>answer, answer</b>)</span><p></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">A7: http://www.motobit.com, http://motobit.cz</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">E7: Ask Google :)</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">Q8: </span><span style="font-size: large;">Search online for the name of the script from Q5 and one of the websites
 from the previous answer. What attack script comes up in your search?</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">A8: WMIBackdoor.ps1 <br /></span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">E8: Ask Google :)</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">Q9: What is the location of this file within the local machine?</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">A9: C:\TMP</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">E9: Null</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q10: </span><span style="font-size: large;">Which 2 processes open and close very quickly every few minutes? (<b>answer, answer</b>)</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A10: mim.exe, powershell.exe</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E10: You can find them from </span><span style="font-size: large;">the window titles OR Task Scheduler</span></p><p dir="ltr" style="text-align: left;"><img alt="" class="w ia ib" height="269" role="presentation" src="https://miro.medium.com/max/1000/1*ckwL3FtL8CxiCxXndwB_fw.png" width="1000" /></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">&nbsp;Q11: What is the parent process for these 2 processes?</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">A11: svchost.exe</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">E11:&nbsp; search for the process in the task manager it will be found with the PID 916 then see Windows&nbsp; Explorer for their parent process OR skimpily you can use the following command wmic process get processid,parentprocessid,executablepath | find "916"&nbsp;&nbsp;</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;"></span></p><div class="separator" style="clear: both; text-align: center;"><span style="font-size: large;"><a href="https://1.bp.blogspot.com/-XLtSJ_Ky0Vg/YOisCRTSWAI/AAAAAAAAAHY/UFrN1FE61Xo7IEGInkKFiein8QVfyQGrwCNcBGAsYHQ/s520/1%2BCzPp1fEPitgQh3wlexbzqw.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="176" data-original-width="520" height="238" src="https://1.bp.blogspot.com/-XLtSJ_Ky0Vg/YOisCRTSWAI/AAAAAAAAAHY/UFrN1FE61Xo7IEGInkKFiein8QVfyQGrwCNcBGAsYHQ/w618-h238/1%2BCzPp1fEPitgQh3wlexbzqw.png" width="618" /></a></span></div><p></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">Q12: What is the first operation for the first of the 2 processe?</span></p><p dir="ltr" style="text-align: justify;"><span style="font-size: large;">A12:&nbsp; Process Start</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E12: We can use Process Monitor ProcMon64.exeavailable here C:\Users\Administrator\Desktop\Tools\SysinternalSuite to monitor what mim.exe is doing. We can put the filter with the Process Name and can check that the first operation is "Process Start"</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q13 : Inspect the properties for the 1st 
occurrence of this process. In the Event tab what are the 4 pieces of 
information displayed?(<span style="font-weight: bolder;">answer,&nbsp;</span><span style="font-weight: bolder;">answer,&nbsp;</span><span style="font-weight: bolder;">answer,&nbsp;</span><span style="font-weight: bolder;">answer</span><span>)</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>A13: Parent PID, Command line, Current directory, Environment</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>E13: You can find it in the same directory and </span></span><span style="font-size: large;"><span>the event properties</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>Q14: </span>Inspect the disk operations, what is the name of the unusual proces?</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A14:&nbsp; No process</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E14: Using hacker process as below&nbsp;</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">&nbsp;</span><img alt="No Process" src="https://res.cloudinary.com/practicaldev/image/fetch/s--albaMp4n--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/8z4psaz2v993whh5bip3.PNG" />                            
                        </p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span># Just remainder to easily solve these coming questions be sure to solve this following room:</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span><span> </span><a href="https://tryhackme.com/room/yara">https://tryhackme.com/room/yara</a><br /></span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>Q15: </span>Run Loki. Inspect the output. What is the name of the module after `Init'?</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A15: WMIScan</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E15: you can run loki with the following command: </span><span style="font-size: large;">loki.exe -l log.txt</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q16: Regarding the 2nd warning, what is the name of the eventFilter?</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A16: ProcessStartTrigger</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E16: Extract it from </span><span style="font-size: large;">'loki-output.txt' NAME section</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"></span></p><div class="separator" style="clear: both; text-align: center;"><span style="font-size: large;"><a href="https://1.bp.blogspot.com/-etwwtyY8ty4/YOjb7MyI7TI/AAAAAAAAAHg/BaMVXFTxobAYiul6cVRjeFUHRrgrx9o6gCNcBGAsYHQ/s729/1%2BuM-LbRI6W2TZZvL9yCAubQ.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="378" data-original-width="729" height="297" src="https://1.bp.blogspot.com/-etwwtyY8ty4/YOjb7MyI7TI/AAAAAAAAAHg/BaMVXFTxobAYiul6cVRjeFUHRrgrx9o6gCNcBGAsYHQ/w624-h297/1%2BuM-LbRI6W2TZZvL9yCAubQ.png" width="624" /></a></span></div><p></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q17: For the 4th warning, what is the class name?</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A17: __FilterToConsumerBinding</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E17: You can find it in loki output in class section above</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q18: What binary alert has the following 4d5a90000300000004000000ffff0000b8000000 as FIRST_BYTES?</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A18: nbtscan.exe</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E18: </span><span style="font-size: large;"><span style="font-size: large;">You can find it in loki output in </span>FIRST_BYTES section</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q19: According to the results, what is the description listed for reason 1?</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A19: Known Bad / Dual use classics</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E19: </span><span style="font-size: large;"><span style="font-size: large;">You can find it in loki output in</span></span><span style="font-size: large;"><span style="font-size: large;"> </span></span><span style="font-size: large;">DESC section&nbsp;</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q20: Which binary alert is marked as APT Cloaked?</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A20: p.exe</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E20: </span><span style="font-size: large;"><span style="font-size: large;"><span style="font-size: large;">You can find it in loki output in</span></span></span><span style="font-size: large;"> </span><span style="font-size: large;">FILE section </span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q21: </span><span style="font-size: large;">What are the matches? (<b>str1, str2</b>)</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A21: psexesvc.exe, Sysinternals PsExec</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E21: </span><span style="font-size: large;"><span style="font-size: large;"><span style="font-size: large;"><span style="font-size: large;">You can find it in loki output in</span></span></span> </span><span style="font-size: large;">MATCHES section</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q22: &nbsp; Which binary alert is associated with somethingwindows.dmp found in C:\TMP?&nbsp;</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A22: schtasks-backdoor.ps1</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E22:</span><span style="font-size: large;"> </span><span style="font-size: large;"><span style="font-size: large;"><span style="font-size: large;"><span style="font-size: large;"><span style="font-size: large;">You can find it in loki output in </span></span></span></span>FILE/INFO</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q23: Which binary is encrypted that is similar to a Trojan?</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A23: xCmd.exe</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E23: You can find&nbsp; it in loki's output </span><span style="font-size: large;">xor-encrypted binary ("Derusbi trojan") in the path C:\TMP\xCmd.exe</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q24: &nbsp; There is a binary that can masquerade itself as a legitimate core Windows process/image. What is the full path of this binary?&nbsp;</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">A24: C:\Users\Public\svchost.exe</span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">E24: an alert from loki for a svchost located at this path </span><span style="font-size: large;"><span style="font-size: large;">(C:\Users\Public\svchost.exe)</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">Q25: What is the full path location for the legitimate version?</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">A25: C:\Windows\System32</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">E25: The default %SYSTEMROOT%</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">Q26: What is the description listed for reason 1?</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">A26: Stuff running where it normally shouldn't</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">E26:&nbsp; You can find that svchost.exe is running from a non standard location, as a parent or child process so it shouldn't be a normal thing</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">Q27: There is a file in the same folder location that is labeled as a hacktool. What is the name of the file?</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">A27: en-US.js</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">E27: you can find it in loki's output in MATCH section and if you open it you will find a susptious J.S file</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">Q28: What is the name of the Yara Rule MATCH?</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">A28: CACTUSTORCH</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span style="font-size: large;">E28: Yara rule already mached it in loki's output</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;">Q29: <span>Which binary didn't show in the Loki results?</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>A29: mim.exe</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>E29: Null (maybe becouse it's running on the task scheduler table "but accually it could be guessed from the output type info")</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>Q30: &nbsp; Complete the yar rule file located within the Tools folder on the Desktop. What are 3 strings to complete the rule in order to detect the binary Loki didn't hit on? (answer, answer, answer)&nbsp;</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>A30: mk.ps1, mk.exe, v2.0.50727</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span>E30: You will need to </span></span><span style="font-size: large;"><span>can use strings64.exe which is already available on this path C:\Users\Administrator\Desktop\Tools\SysinternalSuite and you can find out patterns as you already know the lengths of the strings required in the yara rules using (findstr and regex) so you can edit loki's Yara rule file "test.yar" which in Desktop\Tools\Yara-v4.0.4-1544-win64\test.yar.</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"><span><span>-</span></span></span><span style="font-size: large;"> <span></span></span><span class="Y2IQFc" lang="en"><span style="font-size: large;">Last but not least, I hope you benefited and enjoyed the solution of this room, and thank you for completing this humble writup.</span></span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"> </span></p><p dir="ltr" style="text-align: left;"><span style="font-size: large;"> </span></p><p dir="ltr" style="text-align: left;">
                            
                        </p><p dir="ltr" style="text-align: justify;">
                            </p>

</html>
